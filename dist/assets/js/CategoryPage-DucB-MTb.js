import{r as e,j as t}from"./vendor-frSDhvcu.js";import{u as r}from"./useProduct-DwD5ms5c.js";import{h as a,j as s,k as l,m as o,n,o as i,p as c,q as d,r as u,s as m,t as g,e as x}from"./index-Vo_pZ44y.js";import{P as y}from"./ProductFilter-D1eJOwrX.js";import{P as h}from"./ProductCard-BLZfNBJE.js";import{S as p}from"./seo-MhTlIJlM.js";import{c as f,L as j}from"./vendor-router-CdLpK7Hz.js";import"./vendor-apollo-CIbFPnud.js";import"./LoginWrapper-B4NtgB4h.js";function b(){const{slug:b}=f(),{getProductsByCategory:v,getProductFilters:C,contextLoading:N,contextError:w}=r(),{currentCategory:S,loadCategoryByUrlKey:_,getCategoryBreadcrumbs:k,loading:F,error:P}=(()=>{const[t,r]=e.useState([]),[x,y]=e.useState(null),[h,p]=e.useState(!1),[f,j]=e.useState(null),[b,v]=e.useState(null),[C,N]=e.useState({items:[],total_count:0}),[w,S]=e.useState([]),[_,k]=e.useState({}),[F,P]=e.useState({}),$=e.useRef({categories:t,categoryTree:x,loading:h,error:f,currentCategory:b,categoryProducts:C,productFilters:w,cachedCategoryDetails:_,cachedBreadcrumbs:F});return $.current={categories:t,categoryTree:x,loading:h,error:f,currentCategory:b,categoryProducts:C,productFilters:w,cachedCategoryDetails:_,cachedBreadcrumbs:F},{categories:t,categoryTree:x,loading:h,error:f,currentCategory:b,categoryProducts:C,productFilters:w,loadCategories:e.useCallback((async()=>{p(!0),j(null);try{const e=(await a()).items||[];return r(e),e}catch(e){return j(e.message||"Failed to load categories"),[]}finally{p(!1)}}),[]),loadCategoryTree:e.useCallback((async(e=2)=>{p(!0),j(null);try{const t=await s(e);return y(t),t}catch(t){return j(t.message||"Failed to load category tree"),null}finally{p(!1)}}),[]),loadCategoryById:e.useCallback((async e=>{p(!0),j(null);try{const t=await l(e);return v(t),t}catch(t){return j(t.message||`Failed to load category ${e}`),null}finally{p(!1)}}),[]),loadCategoryByUrlKey:e.useCallback((async e=>{if(p(!0),j(null),$.current.cachedCategoryDetails[e]){const t=$.current.cachedCategoryDetails[e];return v(t),p(!1),t}try{const t=await o(e);return t?(k((r=>({...r,[e]:t}))),v(t)):v(null),t}catch(t){return j(t.message||`Failed to load category ${e}`),v(null),null}finally{p(!1)}}),[k,v,p,j]),loadCategoryProducts:e.useCallback((async(e,t={})=>{p(!0),j(null);try{let r;return r="number"==typeof e?await n(e,t):await i(e,t),N(r),r}catch(r){return j(r.message||`Failed to load products for category ${e}`),{items:[],total_count:0}}finally{p(!1)}}),[]),loadChildCategories:e.useCallback((async e=>{p(!0),j(null);try{return(await c(e)).items||[]}catch(t){return j(t.message||`Failed to load child categories for ${e}`),[]}finally{p(!1)}}),[]),loadCategoryFilters:e.useCallback((async e=>{p(!0),j(null);try{const t=await d(e);return S(t),t}catch(t){return j(t.message||`Failed to load filters for category ${e}`),[]}finally{p(!1)}}),[]),loadFeaturedCategories:e.useCallback((async(e=10)=>{p(!0),j(null);try{return(await u(e)).items||[]}catch(t){return j(t.message||"Failed to load featured categories"),[]}finally{p(!1)}}),[]),searchCategoriesByName:e.useCallback((async(e,t=20)=>{p(!0),j(null);try{return(await m(e,t)).items||[]}catch(r){return j(r.message||`Failed to search categories for "${e}"`),[]}finally{p(!1)}}),[]),getCategoryBreadcrumbs:e.useCallback((async e=>{if(p(!0),j(null),$.current.cachedBreadcrumbs[e])return p(!1),$.current.cachedBreadcrumbs[e];try{const t=(await g(e)).map((e=>({id:e.id,name:e.name,url:`/category/${e.url_key||e.id}`})));return t.length>0&&P((r=>({...r,[e]:t}))),t}catch(t){return j(t.message||`Failed to get breadcrumbs for category ${e}`),[]}finally{p(!1)}}),[P,p,j]),clearError:e.useCallback((()=>j(null)),[])}})(),[$,B]=e.useState([]),[E,A]=e.useState([]),[D,L]=e.useState({}),[T,H]=e.useState([]),[I,M]=e.useState([]),[U,R]=e.useState("position"),[K,Z]=e.useState("ASC"),[q,z]=e.useState(1),[G]=e.useState(12),[O,W]=e.useState(0),[Y,J]=e.useState(!0),[Q,V]=e.useState(!1);e.useEffect((()=>{(async()=>{if(!b)return;V(!0);const e=await _(b);if(e&&e.id){const t=await C(e.id);A(t||[]);const r=await k(e.id);H(r||[]),e.children_data&&M(e.children_data)}})()}),[b,_,C,k]),e.useEffect((()=>{B([]),z(1),J(!0)}),[b,D,U,K]);const X=e.useMemo((()=>Object.entries(D).filter((([,e])=>e.length>0)).map((([e,t])=>{if("price"===e){if(t.length>0){const e=t[0],[r,a]=e.split("_"),s={field:"price"};return r&&"*"!==r&&(s.from=r),a&&"*"!==a&&(s.to=a),{filters:[s]}}return null}return{filters:t.map((t=>({field:e,value:t,condition_type:"in"})))}})).filter((e=>null!==e))),[D]),ee=e.useCallback((async()=>{if(V(!0),!S||!S.id)return void V(!1);const e={currentPage:q,pageSize:G,sortField:U,sortDirection:K,filterGroups:X};try{const t=await v(S.id,e);B(t.items||[]),W(t.total_count||0);const r=Math.ceil((t.total_count||0)/G);J(q<r)}catch(t){}finally{V(!1)}}),[S,q,G,U,K,X,v]);e.useEffect((()=>{S&&ee()}),[ee,S]),e.useEffect((()=>{var e,t,r;if($.length>0){const a=$[0],s=(null==(e=null==a?void 0:a.image)?void 0:e.url)||(null==(t=null==a?void 0:a.small_image)?void 0:t.url)||(null==(r=null==a?void 0:a.thumbnail)?void 0:r.url);if(s){const e=document.getElementById("lcp-image-preload");e&&(e.href=s)}}}),[$]);const te=e.useCallback(((e,t)=>{L((r=>{const a={...r};return 0===t.length?delete a[e]:a[e]=t,a}))}),[]),re=e.useCallback((e=>{const t=e.target.value;if(t.includes("_")){const[e,r]=t.split("_");R(e),Z(r.toUpperCase())}else R(t),Z("ASC")}),[]),ae=e.useCallback((e=>{z(e),window.scrollTo(0,0)}),[]),se=N||F&&!S,le=w||P;if(se&&!S)return t.jsx(x,{});if(le&&!S)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[t.jsx("p",{children:le.message||"An error occurred loading category details."}),t.jsx("p",{className:"mt-2",children:t.jsx(j,{to:"/",className:"text-indigo-600 hover:underline",children:"Return to homepage"})})]})});if(!S&&!se)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:[t.jsx("p",{children:"Category not found."}),t.jsx("p",{className:"mt-2",children:t.jsx(j,{to:"/",className:"text-indigo-600 hover:underline",children:"Return to homepage"})})]})});if(Q&&0===$.length&&S)return t.jsx(x,{});const oe=Math.ceil(O/G);return t.jsxs(t.Fragment,{children:[t.jsx(p,{title:(null==S?void 0:S.name)||"Category Products",description:(null==S?void 0:S.description)||"Browse products in this category.",keywords:(null==S?void 0:S.meta_keywords)||"",ogTitle:(null==S?void 0:S.name)||"Category Products",ogDescription:(null==S?void 0:S.description)||"Browse products in this category.",ogImage:(null==S?void 0:S.image)||"",ogUrl:`${window.location.origin}${location.pathname}`}),t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("nav",{className:"mb-6",children:t.jsxs("ol",{className:"flex flex-wrap text-sm",children:[t.jsxs("li",{className:"flex items-center",children:[t.jsx(j,{to:"/",className:"text-gray-600 hover:text-indigo-600",children:"Home"}),t.jsx("span",{className:"mx-2 text-gray-400",children:"/"})]}),T.map(((e,r)=>t.jsx("li",{className:"flex items-center",children:r===T.length-1?t.jsx("span",{className:"text-indigo-600",children:e.name}):t.jsxs(t.Fragment,{children:[t.jsx(j,{to:e.url,className:"text-gray-600 hover:text-indigo-600",children:e.name}),t.jsx("span",{className:"mx-2 text-gray-400",children:"/"})]})},e.id)))]})}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-4",children:null==S?void 0:S.name}),(null==S?void 0:S.description)&&t.jsx("div",{className:"text-gray-600 mb-4",dangerouslySetInnerHTML:{__html:S.description}})]}),I.length>0&&t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Subcategories"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:I.map((e=>t.jsxs(j,{to:`/category/${e.url_key||e.id}`,className:"bg-gray-100 hover:bg-gray-200 rounded-lg p-4 text-center transition",children:[t.jsx("div",{className:"font-medium",children:e.name}),e.product_count&&t.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.product_count," products"]})]},e.id)))})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[t.jsx("aside",{className:"w-full md:w-1/4",children:E.length>0&&t.jsx(y,{filters:E,appliedFilters:D,onFilterChange:te})}),t.jsxs("main",{className:"w-full md:w-3/4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[t.jsx("div",{className:"mb-4 sm:mb-0",children:t.jsxs("p",{className:"text-gray-600",children:["Showing ",$.length," of ",O," products"]})}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:"sort",className:"mr-2 text-gray-600",children:"Sort by:"}),t.jsxs("select",{id:"sort",className:"border rounded p-2 focus:outline-none focus:ring-2 focus:ring-indigo-600",value:`${U}_${K}`,onChange:re,children:[t.jsx("option",{value:"position_ASC",children:"Position"}),t.jsx("option",{value:"name_ASC",children:"Name (A-Z)"}),t.jsx("option",{value:"name_DESC",children:"Name (Z-A)"}),t.jsx("option",{value:"price_ASC",children:"Price (Low to High)"}),t.jsx("option",{value:"price_DESC",children:"Price (High to Low)"}),t.jsx("option",{value:"created_at_DESC",children:"Newest"})]})]})]}),Q&&0===$.length?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(x,{})}):!Q&&le&&0===$.length?t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:t.jsx("p",{children:le.message||"Could not load products."})}):!Q&&$.length>0?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:$.map(((e,r)=>t.jsx(h,{product:e,isLCPCandidate:0===r&&1===q},e.id||`product-item-${r}`)))}):Q||le||0!==$.length||0!==O?null:t.jsx("div",{className:"bg-gray-100 p-8 text-center rounded-lg",children:t.jsx("p",{className:"text-gray-600",children:"No products found matching your criteria."})}),Q&&$.length>0&&t.jsx("div",{className:"flex justify-center my-8",children:t.jsx(x,{})}),!Q&&$.length>0&&!Y&&O>0&&t.jsx("p",{className:"text-center text-gray-500 my-8",children:"You've reached the end of the results."}),oe>1&&t.jsx("div",{className:"mt-8 flex justify-center",children:t.jsxs("nav",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>ae(q-1),disabled:1===q||Q,className:"mx-1 px-3 py-1 rounded "+(1===q||Q?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Previous"}),[...Array(oe)].map(((e,r)=>{const a=r+1;return 1===a||a===oe||a>=q-1&&a<=q+1?t.jsx("button",{onClick:()=>ae(a),disabled:Q,className:`mx-1 px-3 py-1 rounded ${q===a?"bg-indigo-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"} ${Q?"cursor-not-allowed opacity-50":""}`,children:a},a):a===q-2&&q>3||a===q+2&&q<oe-2?t.jsx("span",{className:"mx-1",children:"..."},a):null})),t.jsx("button",{onClick:()=>ae(q+1),disabled:q===oe||Q,className:"mx-1 px-3 py-1 rounded "+(q===oe||Q?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Next"})]})})]})]})]})]})}export{b as default};
//# sourceMappingURL=CategoryPage-DucB-MTb.js.map
